import{_ as M,c as n,o as i,a as r,b as l,F as y,f as x,t as d,w as E,d as v,v as w,l as S,r as c,m as _,g as j,e as m}from"./app-Buy0xxf1.js";const V={name:"Categories",setup(){const u=c([]),e=c(!1),a=c(null),t=c({name:"",description:"",parent_id:""}),g=_(()=>{const s=localStorage.getItem("user");return s?JSON.parse(s):null}),p=_(()=>g.value&&["admin","gestionnaire"].includes(g.value.role)),o=async()=>{try{const s=await m.get("/categories");u.value=s.data}catch(s){console.error("Erreur lors du chargement des catégories:",s)}},b=async()=>{try{a.value?await m.put(`/categories/${a.value.id}`,t.value):await m.post("/categories",t.value),f(),o()}catch(s){console.error("Erreur lors de l'enregistrement:",s),alert("Erreur lors de l'enregistrement")}},C=s=>{a.value=s,t.value={...s},e.value=!0},k=async s=>{if(confirm(`Êtes-vous sûr de vouloir supprimer ${s.name}?`))try{await m.delete(`/categories/${s.id}`),o()}catch(h){console.error("Erreur lors de la suppression:",h),alert("Erreur lors de la suppression")}},f=()=>{e.value=!1,a.value=null,t.value={name:"",description:"",parent_id:""}};return j(()=>{o()}),{categories:u,showModal:e,editingCategory:a,form:t,canEdit:p,loadCategories:o,saveCategory:b,editCategory:C,deleteCategory:k,closeModal:f}}},A={class:"container mx-auto px-4 py-8"},D={class:"flex justify-between items-center mb-6"},N={class:"bg-white rounded-lg shadow p-6"},B={class:"flex justify-between items-center"},U={class:"font-bold"},F={class:"text-sm text-gray-600"},q={key:0,class:"text-xs text-gray-500"},z={key:0},I=["onClick"],J=["onClick"],L={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},O={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},P={class:"text-lg font-bold mb-4"},T={class:"mb-4"},G={class:"mb-4"},H={class:"mb-4"},K=["value"],Q={class:"flex justify-end space-x-2"};function R(u,e,a,t,g,p){return i(),n("div",A,[r("div",D,[e[6]||(e[6]=r("h1",{class:"text-3xl font-bold"},"Catégories",-1)),t.canEdit?(i(),n("button",{key:0,onClick:e[0]||(e[0]=o=>t.showModal=!0),class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded"}," Ajouter une catégorie ")):l("",!0)]),r("div",N,[(i(!0),n(y,null,x(t.categories,o=>(i(),n("div",{key:o.id,class:"mb-4 p-4 border rounded"},[r("div",B,[r("div",null,[r("h3",U,d(o.name),1),r("p",F,d(o.description||"-"),1),o.parent?(i(),n("p",q,"Parent: "+d(o.parent.name),1)):l("",!0)]),t.canEdit?(i(),n("div",z,[r("button",{onClick:b=>t.editCategory(o),class:"text-indigo-600 hover:text-indigo-900 mr-3"},"Modifier",8,I),r("button",{onClick:b=>t.deleteCategory(o),class:"text-red-600 hover:text-red-900"},"Supprimer",8,J)])):l("",!0)])]))),128))]),t.showModal?(i(),n("div",L,[r("div",O,[r("h3",P,d(t.editingCategory?"Modifier":"Ajouter")+" une catégorie",1),r("form",{onSubmit:e[5]||(e[5]=E((...o)=>t.saveCategory&&t.saveCategory(...o),["prevent"]))},[r("div",T,[e[7]||(e[7]=r("label",{class:"block text-sm font-medium text-gray-700"},"Nom",-1)),v(r("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>t.form.name=o),type:"text",required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[w,t.form.name]])]),r("div",G,[e[8]||(e[8]=r("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),v(r("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.form.description=o),class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[w,t.form.description]])]),r("div",H,[e[10]||(e[10]=r("label",{class:"block text-sm font-medium text-gray-700"},"Catégorie parente",-1)),v(r("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.form.parent_id=o),class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},[e[9]||(e[9]=r("option",{value:""},"Aucune",-1)),!t.editingCategory||u.cat.id!==t.editingCategory.id?(i(!0),n(y,{key:0},x(t.categories,o=>(i(),n("option",{key:o.id,value:o.id},d(o.name),9,K))),128)):l("",!0)],512),[[S,t.form.parent_id]])]),r("div",Q,[r("button",{type:"button",onClick:e[4]||(e[4]=(...o)=>t.closeModal&&t.closeModal(...o)),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"}," Annuler "),e[11]||(e[11]=r("button",{type:"submit",class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded"}," Enregistrer ",-1))])],32)])])):l("",!0)])}const X=M(V,[["render",R]]);export{X as default};
