import{_ as q,c as n,o as d,a as t,b as a,d as l,l as c,v as p,F as M,f as E,w as U,r as y,m as S,g as C,e as v,t as u,n as T}from"./app-Buy0xxf1.js";const N={name:"Movements",setup(){const b=y({data:[]}),e=y([]),g=y(!1),o=y({type:"",date_from:"",date_to:""}),f=y({product_id:"",type:"entree",motion_type:"achat",quantity:1,movement_date:new Date().toISOString().split("T")[0],reason:""}),w=S(()=>{const s=localStorage.getItem("user");return s?JSON.parse(s):null}),r=S(()=>w.value&&["admin","gestionnaire"].includes(w.value.role)),i=async()=>{try{const s={};o.value.type&&(s.type=o.value.type),o.value.date_from&&(s.date_from=o.value.date_from),o.value.date_to&&(s.date_to=o.value.date_to);const m=await v.get("/stock-movements",{params:s});b.value=m.data}catch(s){console.error("Erreur lors du chargement des mouvements:",s)}},x=async()=>{try{const s=await v.get("/products",{params:{per_page:1e3}});e.value=s.data.data}catch(s){console.error("Erreur lors du chargement des produits:",s)}},_=async()=>{var s,m;try{await v.post("/stock-movements",f.value),k(),i()}catch(h){console.error("Erreur lors de l'enregistrement:",h),alert(((m=(s=h.response)==null?void 0:s.data)==null?void 0:m.message)||"Erreur lors de l'enregistrement")}},V=async s=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce mouvement?"))try{await v.delete(`/stock-movements/${s.id}`),i()}catch(m){console.error("Erreur lors de la suppression:",m),alert("Erreur lors de la suppression")}},k=()=>{g.value=!1,f.value={product_id:"",type:"entree",motion_type:"achat",quantity:1,movement_date:new Date().toISOString().split("T")[0],reason:""}},D=s=>new Date(s).toLocaleDateString("fr-FR");return C(()=>{i(),x()}),{movements:b,products:e,showModal:g,filters:o,form:f,canEdit:r,loadMovements:i,saveMovement:_,deleteMovement:V,closeModal:k,formatDate:D}}},F={class:"container mx-auto px-4 py-8"},P={class:"flex justify-between items-center mb-6"},A={class:"bg-white rounded-lg shadow p-4 mb-6"},B={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},I={class:"bg-white rounded-lg shadow overflow-hidden"},O={class:"min-w-full divide-y divide-gray-200"},j={class:"bg-gray-50"},z={key:0,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},L={class:"bg-white divide-y divide-gray-200"},Q={class:"px-6 py-4 whitespace-nowrap text-sm"},R={class:"px-6 py-4 whitespace-nowrap text-sm"},J={class:"px-6 py-4 whitespace-nowrap"},G={class:"px-6 py-4 whitespace-nowrap text-sm"},H={class:"px-6 py-4 whitespace-nowrap text-sm"},K={key:0,class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},W=["onClick"],X={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Y={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},Z={class:"mb-4"},$=["value"],ee={class:"mb-4"},te={class:"mb-4"},oe={key:0,value:"achat"},re={key:1,value:"retour"},se={key:2,value:"correction"},ne={key:3,value:"vente"},de={key:4,value:"perte"},ae={key:5,value:"casse"},le={key:6,value:"expiration"},ie={class:"mb-4"},me={class:"mb-4"},ue={class:"mb-4"},pe={class:"flex justify-end space-x-2"};function ye(b,e,g,o,f,w){return d(),n("div",F,[t("div",P,[e[13]||(e[13]=t("h1",{class:"text-3xl font-bold"},"Mouvements de stock",-1)),o.canEdit?(d(),n("button",{key:0,onClick:e[0]||(e[0]=r=>o.showModal=!0),class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded"}," Nouveau mouvement ")):a("",!0)]),t("div",A,[t("div",B,[l(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.filters.type=r),class:"border border-gray-300 rounded-md px-3 py-2"},[...e[14]||(e[14]=[t("option",{value:""},"Tous les types",-1),t("option",{value:"entree"},"Entrée",-1),t("option",{value:"sortie"},"Sortie",-1)])],512),[[c,o.filters.type]]),l(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.filters.date_from=r),type:"date",class:"border border-gray-300 rounded-md px-3 py-2"},null,512),[[p,o.filters.date_from]]),l(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.filters.date_to=r),type:"date",class:"border border-gray-300 rounded-md px-3 py-2"},null,512),[[p,o.filters.date_to]]),t("button",{onClick:e[4]||(e[4]=(...r)=>o.loadMovements&&o.loadMovements(...r)),class:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"}," Filtrer ")])]),t("div",I,[t("table",O,[t("thead",j,[t("tr",null,[e[15]||(e[15]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Date",-1)),e[16]||(e[16]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Produit",-1)),e[17]||(e[17]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Type",-1)),e[18]||(e[18]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Quantité",-1)),e[19]||(e[19]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Utilisateur",-1)),o.canEdit?(d(),n("th",z,"Actions")):a("",!0)])]),t("tbody",L,[(d(!0),n(M,null,E(o.movements.data,r=>{var i,x;return d(),n("tr",{key:r.id},[t("td",Q,u(o.formatDate(r.movement_date)),1),t("td",R,u((i=r.product)==null?void 0:i.name),1),t("td",J,[t("span",{class:T([r.type==="entree"?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 text-xs font-semibold rounded-full"])},u(r.type==="entree"?"Entrée":"Sortie"),3)]),t("td",G,u(r.quantity),1),t("td",H,u((x=r.user)==null?void 0:x.name),1),o.canEdit?(d(),n("td",K,[t("button",{onClick:_=>o.deleteMovement(r),class:"text-red-600 hover:text-red-900"},"Supprimer",8,W)])):a("",!0)])}),128))])])]),o.showModal?(d(),n("div",X,[t("div",Y,[e[29]||(e[29]=t("h3",{class:"text-lg font-bold mb-4"},"Nouveau mouvement",-1)),t("form",{onSubmit:e[12]||(e[12]=U((...r)=>o.saveMovement&&o.saveMovement(...r),["prevent"]))},[t("div",Z,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700"},"Produit",-1)),l(t("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.product_id=r),required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},[e[20]||(e[20]=t("option",{value:""},"Sélectionner un produit",-1)),(d(!0),n(M,null,E(o.products,r=>(d(),n("option",{key:r.id,value:r.id},u(r.name),9,$))),128))],512),[[c,o.form.product_id]])]),t("div",ee,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700"},"Type",-1)),l(t("select",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.type=r),required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},[...e[22]||(e[22]=[t("option",{value:"entree"},"Entrée",-1),t("option",{value:"sortie"},"Sortie",-1)])],512),[[c,o.form.type]])]),t("div",te,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700"},"Type de mouvement",-1)),l(t("select",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.motion_type=r),required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},[o.form.type==="entree"?(d(),n("option",oe,"Achat")):a("",!0),o.form.type==="entree"?(d(),n("option",re,"Retour")):a("",!0),o.form.type==="entree"?(d(),n("option",se,"Correction")):a("",!0),o.form.type==="sortie"?(d(),n("option",ne,"Vente")):a("",!0),o.form.type==="sortie"?(d(),n("option",de,"Perte")):a("",!0),o.form.type==="sortie"?(d(),n("option",ae,"Casse")):a("",!0),o.form.type==="sortie"?(d(),n("option",le,"Expiration")):a("",!0)],512),[[c,o.form.motion_type]])]),t("div",ie,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700"},"Quantité",-1)),l(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.quantity=r),type:"number",required:"",min:"1",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[p,o.form.quantity,void 0,{number:!0}]])]),t("div",me,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700"},"Date",-1)),l(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.movement_date=r),type:"date",required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[p,o.form.movement_date]])]),t("div",ue,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"Motif",-1)),l(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.reason=r),class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[p,o.form.reason]])]),t("div",pe,[t("button",{type:"button",onClick:e[11]||(e[11]=(...r)=>o.closeModal&&o.closeModal(...r)),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"}," Annuler "),e[28]||(e[28]=t("button",{type:"submit",class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded"}," Enregistrer ",-1))])],32)])])):a("",!0)])}const xe=q(N,[["render",ye]]);export{xe as default};
