import{_ as N,c as l,o as d,a as e,b,d as n,v as m,l as C,F as w,f as _,t as a,w as j,r as p,m as P,g as A,e as x,h as F,i as D,j as q,k as B,n as R}from"./app-Buy0xxf1.js";const T={name:"Products",setup(){const f=p({data:[]}),t=p([]),y=p(!1),r=p(null),u=p({search:"",category_id:""}),c=p({name:"",description:"",barcode:"",price:0,category_id:"",stock_minimum:0,stock_optimal:0}),g=P(()=>{const s=localStorage.getItem("user");return s?JSON.parse(s):null}),o=P(()=>g.value&&["admin","gestionnaire"].includes(g.value.role)),i=async()=>{try{const s={};u.value.search&&(s.search=u.value.search),u.value.category_id&&(s.category_id=u.value.category_id);const k=await x.get("/products",{params:s});f.value=k.data}catch(s){console.error("Erreur lors du chargement des produits:",s)}},v=async()=>{try{const s=await x.get("/categories");t.value=s.data}catch(s){console.error("Erreur lors du chargement des catégories:",s)}},E=async()=>{try{r.value?await x.put(`/products/${r.value.id}`,c.value):await x.post("/products",c.value),h(),i()}catch(s){console.error("Erreur lors de l'enregistrement:",s),alert("Erreur lors de l'enregistrement")}},V=s=>{r.value=s,c.value={...s},y.value=!0},M=async s=>{if(confirm(`Êtes-vous sûr de vouloir supprimer ${s.name}?`))try{await x.delete(`/products/${s.id}`),i()}catch(k){console.error("Erreur lors de la suppression:",k),alert("Erreur lors de la suppression")}},h=()=>{y.value=!1,r.value=null,c.value={name:"",description:"",barcode:"",price:0,category_id:"",stock_minimum:0,stock_optimal:0}},S=s=>s.current_stock<=s.stock_minimum?"bg-red-100 text-red-800":s.current_stock<=s.stock_optimal?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800",U=s=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s);return A(()=>{i(),v()}),{products:f,categories:t,showModal:y,editingProduct:r,filters:u,form:c,canEdit:o,loadProducts:i,saveProduct:E,editProduct:V,deleteProduct:M,closeModal:h,getStockClass:S,formatCurrency:U}}},z={class:"container mx-auto px-4 py-8"},I={class:"flex justify-between items-center mb-6"},J={class:"bg-white rounded-lg shadow p-4 mb-6"},L={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},O=["value"],G={class:"bg-white rounded-lg shadow overflow-hidden"},H={class:"min-w-full divide-y divide-gray-200"},K={class:"bg-gray-50"},Q={key:0,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},W={class:"bg-white divide-y divide-gray-200"},X={class:"px-6 py-4 whitespace-nowrap"},Y={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Z={class:"px-6 py-4 whitespace-nowrap"},$={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},tt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},et={key:0,class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},ot=["onClick"],rt=["onClick"],st={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},lt={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},dt={class:"text-lg font-bold mb-4"},nt={class:"mb-4"},at={class:"mb-4"},it={class:"mb-4"},mt={class:"mb-4"},ut={class:"mb-4"},ct=["value"],pt={class:"mb-4"},xt={class:"mb-4"},yt={class:"flex justify-end space-x-2"};function gt(f,t,y,r,u,c){const g=F("router-link");return d(),l("div",z,[e("div",I,[t[13]||(t[13]=e("h1",{class:"text-3xl font-bold"},"Produits",-1)),r.canEdit?(d(),l("button",{key:0,onClick:t[0]||(t[0]=o=>r.showModal=!0),class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded"}," Ajouter un produit ")):b("",!0)]),e("div",J,[e("div",L,[n(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.filters.search=o),type:"text",placeholder:"Rechercher...",class:"border border-gray-300 rounded-md px-3 py-2"},null,512),[[m,r.filters.search]]),n(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.filters.category_id=o),class:"border border-gray-300 rounded-md px-3 py-2"},[t[14]||(t[14]=e("option",{value:""},"Toutes les catégories",-1)),(d(!0),l(w,null,_(r.categories,o=>(d(),l("option",{key:o.id,value:o.id},a(o.name),9,O))),128))],512),[[C,r.filters.category_id]]),e("button",{onClick:t[3]||(t[3]=(...o)=>r.loadProducts&&r.loadProducts(...o)),class:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"}," Filtrer ")])]),e("div",G,[e("table",H,[e("thead",K,[e("tr",null,[t[15]||(t[15]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Nom",-1)),t[16]||(t[16]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Code-barres",-1)),t[17]||(t[17]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Stock",-1)),t[18]||(t[18]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Prix",-1)),t[19]||(t[19]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Catégorie",-1)),r.canEdit?(d(),l("th",Q,"Actions")):b("",!0)])]),e("tbody",W,[(d(!0),l(w,null,_(r.products.data,o=>{var i;return d(),l("tr",{key:o.id},[e("td",X,[D(g,{to:`/products/${o.id}`,class:"text-indigo-600 hover:text-indigo-900"},{default:q(()=>[B(a(o.name),1)]),_:2},1032,["to"])]),e("td",Y,a(o.barcode||"-"),1),e("td",Z,[e("span",{class:R([r.getStockClass(o),"px-2 py-1 text-xs font-semibold rounded-full"])},a(o.current_stock),3)]),e("td",$,a(r.formatCurrency(o.price)),1),e("td",tt,a(((i=o.category)==null?void 0:i.name)||"-"),1),r.canEdit?(d(),l("td",et,[e("button",{onClick:v=>r.editProduct(o),class:"text-indigo-600 hover:text-indigo-900 mr-3"},"Modifier",8,ot),e("button",{onClick:v=>r.deleteProduct(o),class:"text-red-600 hover:text-red-900"},"Supprimer",8,rt)])):b("",!0)])}),128))])])]),r.showModal?(d(),l("div",st,[e("div",lt,[e("h3",dt,a(r.editingProduct?"Modifier":"Ajouter")+" un produit",1),e("form",{onSubmit:t[12]||(t[12]=j((...o)=>r.saveProduct&&r.saveProduct(...o),["prevent"]))},[e("div",nt,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700"},"Nom",-1)),n(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.form.name=o),type:"text",required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[m,r.form.name]])]),e("div",at,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),n(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>r.form.description=o),class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[m,r.form.description]])]),e("div",it,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700"},"Code-barres",-1)),n(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>r.form.barcode=o),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[m,r.form.barcode]])]),e("div",mt,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700"},"Prix",-1)),n(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>r.form.price=o),type:"number",step:"0.01",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[m,r.form.price]])]),e("div",ut,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700"},"Catégorie",-1)),n(e("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>r.form.category_id=o),class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},[t[24]||(t[24]=e("option",{value:""},"Aucune",-1)),(d(!0),l(w,null,_(r.categories,o=>(d(),l("option",{key:o.id,value:o.id},a(o.name),9,ct))),128))],512),[[C,r.form.category_id]])]),e("div",pt,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700"},"Stock minimum",-1)),n(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>r.form.stock_minimum=o),type:"number",required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[m,r.form.stock_minimum]])]),e("div",xt,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700"},"Stock optimal",-1)),n(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>r.form.stock_optimal=o),type:"number",required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[m,r.form.stock_optimal]])]),e("div",yt,[e("button",{type:"button",onClick:t[11]||(t[11]=(...o)=>r.closeModal&&r.closeModal(...o)),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"}," Annuler "),t[28]||(t[28]=e("button",{type:"submit",class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded"}," Enregistrer ",-1))])],32)])])):b("",!0)])}const ft=N(T,[["render",gt]]);export{ft as default};
