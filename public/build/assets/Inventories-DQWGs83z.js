import{_ as N,c as l,o as i,a as t,b as w,w as S,F as h,f as k,d as m,v as g,t as c,r as v,m as C,g as T,e as I,h as A,k as V,n as O,i as z,j as B,l as F}from"./app-Buy0xxf1.js";const J={name:"Inventories",setup(){const y=v({data:[]}),e=v([]),u=v(!1),o=v(!1),r=v({inventory_date:new Date().toISOString().split("T")[0],notes:"",items:[{product_id:"",actual_quantity:0,justification:""}]}),b=C(()=>{const n=localStorage.getItem("user");return n?JSON.parse(n):null}),x=C(()=>b.value&&["admin","gestionnaire"].includes(b.value.role)),s=async()=>{try{const n=await I.get("/inventories");y.value=n.data}catch(n){console.error("Erreur lors du chargement des inventaires:",n)}},p=async()=>{try{const n=await I.get("/products");e.value=n.data.data||n.data}catch(n){console.error("Erreur lors du chargement des produits:",n)}},a=n=>new Date(n).toLocaleDateString("fr-FR"),j=n=>({en_cours:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs",termine:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",archive:"bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs"})[n]||"px-2 py-1 rounded text-xs",D=()=>{r.value.items.push({product_id:"",actual_quantity:0,justification:""})},M=n=>{r.value.items.length>1&&r.value.items.splice(n,1)},q=()=>{o.value||(u.value=!u.value)},U=async()=>{var n,f;if(r.value.items.some(d=>!d.product_id)){alert("Veuillez sélectionner un produit pour chaque article");return}o.value=!0;try{const d=await I.post("/inventories",{inventory_date:r.value.inventory_date,notes:r.value.notes,items:r.value.items.map(_=>({product_id:parseInt(_.product_id),actual_quantity:_.actual_quantity,justification:_.justification}))});console.log("Inventaire créé:",d.data),r.value={inventory_date:new Date().toISOString().split("T")[0],notes:"",items:[{product_id:"",actual_quantity:0,justification:""}]},u.value=!1,await s(),alert("Inventaire créé avec succès !")}catch(d){console.error("Erreur lors de la création de l'inventaire:",d),alert("Erreur: "+(((f=(n=d.response)==null?void 0:n.data)==null?void 0:f.message)||d.message))}finally{o.value=!1}},E=()=>{u.value=!1,r.value={inventory_date:new Date().toISOString().split("T")[0],notes:"",items:[{product_id:"",actual_quantity:0,justification:""}]}};return T(()=>{s(),p()}),{inventories:y,products:e,showModal:u,loading:o,form:r,canEdit:x,loadInventories:s,formatDate:a,getStatusClass:j,addItem:D,removeItem:M,toggleModal:q,createInventory:U,closeModal:E}}},L={class:"container mx-auto px-4 py-8"},P={key:0,class:"mb-6"},Q=["disabled"],R={class:"bg-white rounded-lg shadow p-6"},G={key:0,class:"text-center py-4 text-gray-500"},H={class:"flex justify-between items-center"},K={class:"font-bold"},W={class:"text-sm text-gray-600"},X={class:"text-sm text-gray-600"},Y={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Z={class:"relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white"},$={class:"mb-4"},tt={class:"mb-4"},et={class:"mb-6"},ot={class:"max-h-64 overflow-y-auto border border-gray-300 rounded"},st={class:"flex-1"},nt=["onUpdate:modelValue"],at=["value"],rt={class:"w-24"},lt=["onUpdate:modelValue"],it={class:"flex-1"},dt=["onUpdate:modelValue"],ut=["onClick"],ct={class:"flex justify-end space-x-2"},mt=["disabled"];function vt(y,e,u,o,r,b){const x=A("router-link");return i(),l("div",L,[e[13]||(e[13]=t("h1",{class:"text-3xl font-bold mb-6"},"Inventaires",-1)),o.canEdit?(i(),l("div",P,[t("button",{onClick:e[0]||(e[0]=S((...s)=>o.toggleModal&&o.toggleModal(...s),["prevent"])),type:"button",disabled:o.loading,class:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white font-bold py-2 px-4 rounded transition"}," Nouvel inventaire ",8,Q)])):w("",!0),t("div",R,[o.inventories.data.length===0?(i(),l("div",G," Aucun inventaire pour le moment ")):w("",!0),(i(!0),l(h,null,k(o.inventories.data,s=>(i(),l("div",{key:s.id,class:"mb-4 p-4 border rounded"},[t("div",H,[t("div",null,[t("h3",K,c(s.reference),1),t("p",W,"Date: "+c(o.formatDate(s.inventory_date)),1),t("p",X,[e[6]||(e[6]=V("Statut: ",-1)),t("span",{class:O(o.getStatusClass(s.status))},c(s.status),3)])]),t("div",null,[z(x,{to:`/inventories/${s.id}`,class:"text-indigo-600 hover:text-indigo-900"},{default:B(()=>[...e[7]||(e[7]=[V(" Voir détails ",-1)])]),_:1},8,["to"])])])]))),128))]),o.showModal?(i(),l("div",Y,[t("div",Z,[e[12]||(e[12]=t("h3",{class:"text-lg font-bold mb-4"},"Créer un nouvel inventaire",-1)),t("form",{onSubmit:e[5]||(e[5]=S((...s)=>o.createInventory&&o.createInventory(...s),["prevent"]))},[t("div",$,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"Date d'inventaire",-1)),m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.inventory_date=s),type:"date",required:"",class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[g,o.form.inventory_date]])]),t("div",tt,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700"},"Notes",-1)),m(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.notes=s),class:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",rows:"3"},null,512),[[g,o.form.notes]])]),t("div",et,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Articles à inventorier",-1)),t("div",ot,[(i(!0),l(h,null,k(o.form.items,(s,p)=>(i(),l("div",{key:p,class:"p-3 border-b flex gap-2"},[t("div",st,[m(t("select",{"onUpdate:modelValue":a=>s.product_id=a,required:"",class:"w-full border border-gray-300 rounded px-2 py-1 text-sm"},[e[10]||(e[10]=t("option",{value:""},"Sélectionner un produit",-1)),(i(!0),l(h,null,k(o.products,a=>(i(),l("option",{key:a.id,value:a.id},c(a.name)+" (Stock: "+c(a.current_stock)+") ",9,at))),128))],8,nt),[[F,s.product_id]])]),t("div",rt,[m(t("input",{"onUpdate:modelValue":a=>s.actual_quantity=a,type:"number",min:"0",placeholder:"Qté",class:"w-full border border-gray-300 rounded px-2 py-1 text-sm"},null,8,lt),[[g,s.actual_quantity,void 0,{number:!0}]])]),t("div",it,[m(t("input",{"onUpdate:modelValue":a=>s.justification=a,type:"text",placeholder:"Justification (optionnel)",class:"w-full border border-gray-300 rounded px-2 py-1 text-sm"},null,8,dt),[[g,s.justification]])]),t("button",{type:"button",onClick:a=>o.removeItem(p),class:"text-red-600 hover:text-red-900"}," ✕ ",8,ut)]))),128))]),t("button",{type:"button",onClick:e[3]||(e[3]=(...s)=>o.addItem&&o.addItem(...s)),class:"mt-2 text-indigo-600 hover:text-indigo-900 text-sm font-medium"}," + Ajouter un article ")]),t("div",ct,[t("button",{type:"button",onClick:e[4]||(e[4]=(...s)=>o.closeModal&&o.closeModal(...s)),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"}," Annuler "),t("button",{type:"submit",disabled:o.loading||o.form.items.length===0,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},c(o.loading?"Création en cours...":"Créer"),9,mt)])],32)])])):w("",!0)])}const gt=N(J,[["render",vt]]);export{gt as default};
